import{D as a,A as i}from"./index-h8EpgnIO.js";const c=a("cart",{state:()=>({cartItems:[],shipping:0,discount:0}),getters:{totalItems:t=>t.cartItems.reduce((s,e)=>s+e.quantity,0),subtotal:t=>t.cartItems.reduce((s,e)=>s+e.price*e.quantity,0),total(){return this.subtotal+this.shipping-this.discount},isEmpty:t=>t.cartItems.length===0},actions:{loadFromLocalStorage(){try{const t=localStorage.getItem("shopping_cart");if(t){const s=JSON.parse(t);this.cartItems=s.cartItems||[],this.shipping=s.shipping||0,this.discount=s.discount||0}}catch(t){console.error("加载购物车数据失败:",t),this.cartItems=[]}},saveToLocalStorage(){try{const t={cartItems:this.cartItems,shipping:this.shipping,discount:this.discount,lastUpdated:new Date().toISOString()};localStorage.setItem("shopping_cart",JSON.stringify(t))}catch(t){console.error("保存购物车数据失败:",t)}},addToCart(t,s=1){const e=this.cartItems.find(r=>r.id===t.id);if(e){const r=e.quantity+s;if(t.stock&&r>t.stock)throw new Error(`库存不足，当前库存为${t.stock}件`);if(t.maxPurchase&&r>t.maxPurchase)throw new Error(`该商品最多只能购买${t.maxPurchase}件`);e.quantity=r}else{if(t.stock&&s>t.stock)throw new Error(`库存不足，当前库存为${t.stock}件`);if(t.maxPurchase&&s>t.maxPurchase)throw new Error(`该商品最多只能购买${t.maxPurchase}件`);this.cartItems.push({...t,quantity:s})}this.saveToLocalStorage(),i.success({message:"加入购物车成功",duration:2e3})},increaseQuantity(t){const s=this.cartItems.find(e=>e.id===t);if(s){if(s.stock&&s.quantity>=s.stock)throw new Error("库存不足，无法增加数量");if(s.maxPurchase&&s.quantity>=s.maxPurchase)throw new Error(`该商品最多只能购买${s.maxPurchase}件`);s.quantity++,this.saveToLocalStorage()}},decreaseQuantity(t){const s=this.cartItems.find(e=>e.id===t);s&&(s.quantity>1?(s.quantity--,this.saveToLocalStorage()):this.removeFromCart(t))},updateQuantity(t,s){const e=this.cartItems.find(r=>r.id===t);if(e){if(s<1){this.removeFromCart(t);return}if(e.stock&&s>e.stock)throw new Error(`库存不足，当前库存为${e.stock}件`);if(e.maxPurchase&&s>e.maxPurchase)throw new Error(`该商品最多只能购买${e.maxPurchase}件`);e.quantity=s,this.saveToLocalStorage()}},removeFromCart(t){this.cartItems=this.cartItems.filter(s=>s.id!==t),this.saveToLocalStorage()},clearCart(){this.cartItems=[],this.saveToLocalStorage()},isInCart(t){return this.cartItems.some(s=>s.id===t)},getItemQuantity(t){const s=this.cartItems.find(e=>e.id===t);return s?s.quantity:0}}});export{c as u};
