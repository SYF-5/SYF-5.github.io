import{D as i,A as o}from"./index-DgTuOyx3.js";import{u as c}from"./user-CjfI2Pr5.js";const m=i("cart",{state:()=>({cartItems:[],shipping:0,discount:0}),getters:{totalItems:t=>t.cartItems.reduce((s,r)=>s+r.quantity,0),subtotal:t=>t.cartItems.reduce((s,r)=>s+r.price*r.quantity,0),total(){return this.subtotal+this.shipping-this.discount},isEmpty:t=>t.cartItems.length===0},actions:{loadFromLocalStorage(){try{const t=localStorage.getItem("shopping_cart");if(t){const s=JSON.parse(t);this.cartItems=s.cartItems||[],this.shipping=s.shipping||0,this.discount=s.discount||0}}catch(t){console.error("加载购物车数据失败:",t),this.cartItems=[]}},saveToLocalStorage(){try{const t={cartItems:this.cartItems,shipping:this.shipping,discount:this.discount,lastUpdated:new Date().toISOString()};localStorage.setItem("shopping_cart",JSON.stringify(t))}catch(t){console.error("保存购物车数据失败:",t)}},addToCart(t,s=1){if(!c().isLogin)throw new Error("请先登录");const e=this.cartItems.find(a=>a.id===t.id);if(e){const a=e.quantity+s;if(t.stock&&a>t.stock)throw new Error(`库存不足，当前库存为${t.stock}件`);if(t.maxPurchase&&a>t.maxPurchase)throw new Error(`该商品最多只能购买${t.maxPurchase}件`);e.quantity=a}else{if(t.stock&&s>t.stock)throw new Error(`库存不足，当前库存为${t.stock}件`);if(t.maxPurchase&&s>t.maxPurchase)throw new Error(`该商品最多只能购买${t.maxPurchase}件`);this.cartItems.push({...t,quantity:s})}this.saveToLocalStorage(),o.success({message:"加入购物车成功",duration:2e3})},increaseQuantity(t){const s=this.cartItems.find(r=>r.id===t);if(s){if(s.stock&&s.quantity>=s.stock)throw new Error("库存不足，无法增加数量");if(s.maxPurchase&&s.quantity>=s.maxPurchase)throw new Error(`该商品最多只能购买${s.maxPurchase}件`);s.quantity++,this.saveToLocalStorage()}},decreaseQuantity(t){const s=this.cartItems.find(r=>r.id===t);s&&(s.quantity>1?(s.quantity--,this.saveToLocalStorage()):this.removeFromCart(t))},updateQuantity(t,s){const r=this.cartItems.find(e=>e.id===t);if(r){if(s<1){this.removeFromCart(t);return}if(r.stock&&s>r.stock)throw new Error(`库存不足，当前库存为${r.stock}件`);if(r.maxPurchase&&s>r.maxPurchase)throw new Error(`该商品最多只能购买${r.maxPurchase}件`);r.quantity=s,this.saveToLocalStorage()}},removeFromCart(t){this.cartItems=this.cartItems.filter(s=>s.id!==t),this.saveToLocalStorage()},clearCart(){this.cartItems=[],this.saveToLocalStorage()},isInCart(t){return this.cartItems.some(s=>s.id===t)},getItemQuantity(t){const s=this.cartItems.find(r=>r.id===t);return s?s.quantity:0}}});export{m as u};
