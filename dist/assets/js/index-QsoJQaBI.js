import{d as J,r as f,o as U,b as X,f as c,h as s,i as E,F as y,j as w,g as l,k as H,e as j,l as N,m as F,t as _,p as Y,q as K,_ as R,c as z,s as A,u as O,E as Z,v as ee,x as se}from"./index-CAZUSK-b.js";import{p as b}from"./productService-DLGyYyOD.js";import{u as te}from"./cart-JK6ohYZa.js";const oe={class:"home-category"},ne={class:"menu"},le={key:0,class:"loading"},ae={key:1,class:"empty"},ie=["onMouseenter"],ce=["onClick"],re={key:0,class:"layer"},de=["onClick"],ue={class:"image-container"},ge=["src","alt","onLoad","onError"],_e={key:0,class:"loading-placeholder"},me={class:"info"},ve={class:"name ellipsis-2"},he={class:"desc ellipsis"},fe={class:"price"},pe=J({__name:"HomeCategory",setup(M){const k=K(),u=f([]),C=f(!0),h=f(null),m=f({}),v=f(null);let p=null;const W=e=>{p&&(clearTimeout(p),p=null),v.value=e,u.value[e]&&P(u.value[e].id)},G=()=>{p=setTimeout(()=>{v.value=null},150)},q=async()=>{try{C.value=!0,h.value=null,console.log("å¼€å§‹èŽ·å–åˆ†ç±»æ•°æ®..."),await b.loadAllData();const e=b.getCategories();console.log("èŽ·å–åˆ°çš„åˆ†ç±»æ•°æ®:",e),e&&e.length>0?(u.value=e,console.log("æˆåŠŸè®¾ç½®åˆ†ç±»æ•°æ®:",u.value.length,"ä¸ªåˆ†ç±»"),u.value.length>0&&setTimeout(()=>{r()},1e3)):(console.warn("æ²¡æœ‰èŽ·å–åˆ°åˆ†ç±»æ•°æ®"),h.value="æš‚æ— åˆ†ç±»æ•°æ®")}catch(e){console.error("èŽ·å–åˆ†ç±»æ•°æ®å¤±è´¥:",e),h.value="æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"}finally{C.value=!1}},I={1:"/images/list-01.jpg",2:"/images/list-02.jpg",3:"/images/list-03.jpg",4:"/images/list-04.webp",5:"/images/list-05.jpg",6:"/images/list-06.jpg",7:"/images/list-07.webp",8:"/images/list-08.jpg",9:"/images/list-09.jpg",10:"/images/list-10.webp"},x=(e,a)=>{if(e&&typeof e=="string"){if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/"))return e;if(!e.startsWith("/"))return`/${e}`}if(a&&I[a])return I[a];if(a){const d=[1,2,3,4,5,6,7,8,9,10],i=(a-1)%d.length,g=d[i],n=I[g]?.endsWith(".webp")?".webp":".jpg";return`/images/list-${String(g).padStart(2,"0")}${n}`}return"/images/cx.svg"},B=(e,a)=>{const d=e.target;console.warn(`å•†å“ ${a} å›¾ç‰‡åŠ è½½å¤±è´¥: ${d.src}`),d.src="/images/cx.svg",m.value[a]===!1&&(m.value[a]=!0)},T=(e,a,d)=>{console.log(`ç‚¹å‡»äº† ${a} - ${d}`);const i=b.getGoodsByCategoryId(e);if(i&&i.length>0){const g=i[0];k.push(`/product/${g.id}`)}else alert("è¯¥åˆ†ç±»ä¸‹æš‚æ— å•†å“")},D=e=>{console.log(`ç‚¹å‡»äº†å•†å“ ID: ${e}`),k.push(`/product/${e}`)},S=e=>{m.value[e]=!0},L=e=>{const d=(b.getGoodsByCategoryId(e)||[]).slice(0,6);return d.forEach(i=>{m.value[i.id]||(m.value[i.id]=!1)}),d},P=e=>{const a=L(e);if(!a||a.length===0)return;a.slice(0,3).forEach(i=>{const g=x(i.picture,i.id);if(o(g))return;const n=new Image;n.src=g,n.onload=()=>{console.log(`é¢„åŠ è½½æˆåŠŸ: ${i.id}`),m.value[i.id]=!0},n.onerror=()=>{console.log(`é¢„åŠ è½½å¤±è´¥: ${i.id}`)}})},o=e=>{try{const a=new Image;return a.src=e,a.complete}catch{return!1}},r=()=>{"requestIdleCallback"in window?requestIdleCallback(()=>{u.value.length>0&&(console.log("ç©ºé—²æ—¶é—´é¢„åŠ è½½ç¬¬ä¸€ä¸ªåˆ†ç±»å›¾ç‰‡"),P(u.value[0].id))},{timeout:2e3}):setTimeout(()=>{u.value.length>0&&(console.log("å®šæ—¶å™¨é¢„åŠ è½½ç¬¬ä¸€ä¸ªåˆ†ç±»å›¾ç‰‡"),P(u.value[0].id))},2e3)},t=()=>{if("requestIdleCallback"in window){const e=a=>{const d=u.value.filter((g,n)=>n>0);let i=0;for(;a.timeRemaining()>0&&i<d.length;){const g=d[i],n=b.getGoodsByCategoryId(g.id)||[];if(n.length>0){const $=n[0],V=x($.picture,$.id);if(!o(V)){const Q=new Image;Q.src=V}}i++}i<d.length&&requestIdleCallback(e)};setTimeout(()=>{requestIdleCallback(e)},3e3)}};return U(()=>{console.log("ä¾§è¾¹åˆ—è¡¨ç»„ä»¶å·²æŒ‚è½½"),q().then(()=>{setTimeout(()=>{t()},3e3)})}),X(()=>{p&&clearTimeout(p)}),(e,a)=>{const d=Y("RouterLink");return l(),c("div",oe,[s("ul",ne,[C.value?(l(),c("li",le," åˆ†ç±»åŠ è½½ä¸­... ")):u.value.length===0?(l(),c("li",ae," æš‚æ— åˆ†ç±»æ•°æ® ")):E("",!0),(l(!0),c(y,null,w(u.value,(i,g)=>(l(),c("li",{key:i.id,class:H({"is-active":v.value===g}),onMouseenter:n=>W(g),onMouseleave:G},[j(d,{to:"/category"},{default:N(()=>[F(_(i.name),1)]),_:2},1024),(l(!0),c(y,null,w(i.children,n=>(l(),c("a",{key:n,href:"javascript:;",onClick:$=>T(i.id,i.name,n),class:"sub-category-link"},_(n),9,ce))),128)),v.value===g?(l(),c("div",re,[a[1]||(a[1]=s("h4",null,[F("åˆ†ç±»æŽ¨è "),s("small",null,"æ ¹æ®æ‚¨çš„è´­ä¹°æˆ–æµè§ˆè®°å½•æŽ¨è")],-1)),s("ul",null,[(l(!0),c(y,null,w(L(i.id),n=>(l(),c("li",{key:n.id},[s("a",{href:"javascript:;",onClick:$=>D(n.id),class:"product-link"},[s("div",ue,[s("img",{src:x(n.picture,n.id),alt:n.name,onLoad:$=>S(n.id),onError:$=>B($,n.id)},null,40,ge),m.value[n.id]?E("",!0):(l(),c("div",_e))]),s("div",me,[s("p",ve,_(n.name),1),s("p",he,_(n.desc),1),s("p",fe,[a[0]||(a[0]=s("i",null,"Â¥",-1)),F(_(n.price?.toFixed(2)),1)])])],8,de)]))),128))])])):E("",!0)],42,ie))),128))])])}}}),ye=R(pe,[["__scopeId","data-v-c0579435"]]),ke={class:"home"},Ce={class:"main-container"},$e={class:"category-nav"},be=["onClick"],we={class:"category-icon"},Ie={class:"category-name"},xe={key:0,class:"loading-state"},Ee={key:1,class:"error-state"},Le={class:"product-section"},Pe={class:"products-grid"},je=["onClick"],Be={class:"product-image"},Te=["src","alt","onLoad","onError"],Se={key:0,class:"loading-placeholder"},Me={class:"product-info"},We={class:"desc"},Ge={class:"price"},qe=["onClick"],De={key:0,class:"success-message"},Fe={class:"product-section"},He={class:"products-grid"},Ne=["onClick"],Ue={class:"product-image"},Re=["src","alt","onLoad","onError"],Ve={key:0,class:"loading-placeholder"},ze={class:"product-info"},Ae={class:"desc"},Oe={class:"price"},Je=["onClick"],Ke={__name:"HomeProduct",setup(M){const k=K(),u=te(),C=f(!1),h=f(null),m=f([]),v=f({}),p=f({}),W=z(()=>m.value.slice(0,4)),G=z(()=>m.value.slice(4)),q=["è”¬èœ","æ°´æžœ","è‚‰ç±»","ç²®æ²¹","å¥¶åˆ¶å“","é›¶é£Ÿ"],I=(o,r)=>{if(!o||o.trim()==="")return"/images/cx.svg";const t=o.trim();if(t.startsWith("http://")||t.startsWith("https://"))return t;let e=t;return e.startsWith("./")&&(e=e.substring(2)),e.startsWith("/")||(e="/"+e),e.includes("/list-")&&!e.includes("list-01")&&!e.includes("list-02")&&!e.includes("list-03")?"/images/cx.svg":e},x=(o,r)=>{const t=o.target;console.warn(`å•†å“ ${r} å›¾ç‰‡åŠ è½½å¤±è´¥: ${t.src}`),t.src="/images/cx.svg",v.value[r]===!1&&(v.value[r]=!0)},B=o=>{v.value[o]=!0},T=async()=>{console.log("å¼€å§‹èŽ·å–å•†å“æ•°æ®..."),C.value=!0,h.value=null;try{await b.loadAllData();const o=b.getProductsOnly();console.log("èŽ·å–åˆ°çš„çœŸå®žå•†å“:",o),o&&o.length>0?(m.value=o,o.forEach(r=>{v.value[r.id]=!1}),console.log("æˆåŠŸè®¾ç½®çœŸå®žå•†å“åˆ—è¡¨ï¼Œæ•°é‡:",o.length)):(h.value="æš‚æ— å•†å“æ•°æ®",console.log("æ²¡æœ‰èŽ·å–åˆ°å•†å“æ•°æ®"))}catch(o){console.error("èŽ·å–å•†å“å¤±è´¥:",o),h.value="æ•°æ®åŠ è½½å¤±è´¥: "+o.message}finally{C.value=!1}},D=o=>{console.log("ç‚¹å‡»åˆ†ç±»:",o)},S=o=>{console.log("è·³è½¬åˆ°å•†å“è¯¦æƒ…:",o.id),k.push(`/product/${o.id}`)},L=async o=>{console.log("æ·»åŠ åˆ°è´­ç‰©è½¦:",o.name),await u.addToCart(o,1),p.value[o.id]=!0,setTimeout(()=>{p.value[o.id]=!1},3e3)},P=o=>({è”¬èœ:"ðŸ¥¬",æ°´æžœ:"ðŸŽ",è‚‰ç±»:"ðŸ¥©",ç²®æ²¹:"ðŸš",å¥¶åˆ¶å“:"ðŸ¥›",é›¶é£Ÿ:"ðŸª"})[o]||"ðŸ›’";return U(()=>{console.log("é¦–é¡µç»„ä»¶æŒ‚è½½"),T()}),(o,r)=>(l(),c("div",ke,[r[3]||(r[3]=s("div",{class:"banner-container"},[s("div",{class:"banner"},[s("img",{src:"/src/assets/images/cx.jpg",alt:"å°å…”é²œä¿ƒé”€æ¨ªå¹…"})])],-1)),s("div",Ce,[s("div",$e,[(l(),c(y,null,w(q,t=>s("div",{class:"category-item",key:t,onClick:e=>D(t)},[s("span",we,_(P(t)),1),s("span",Ie,_(t),1)],8,be)),64))]),C.value?(l(),c("div",xe,[...r[0]||(r[0]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"å•†å“åŠ è½½ä¸­...",-1)])])):h.value?(l(),c("div",Ee,[s("p",null,_(h.value),1),s("button",{onClick:T,class:"retry-btn"},"é‡è¯•")])):(l(),c(y,{key:2},[s("div",Le,[r[1]||(r[1]=s("h2",{class:"section-title"},"æ–°é²œå¥½ç‰©",-1)),s("div",Pe,[(l(!0),c(y,null,w(W.value,t=>(l(),c("div",{class:"product-item",key:t.id,onClick:e=>S(t)},[s("div",Be,[s("img",{src:I(t.picture,t.id),alt:t.name,onLoad:()=>B(t.id),onError:e=>x(e,t.id),class:H({loaded:v.value[t.id]})},null,42,Te),v.value[t.id]?E("",!0):(l(),c("div",Se))]),s("div",Me,[s("h3",null,_(t.name),1),s("p",We,_(t.desc||t.description),1),s("p",Ge,"Â¥"+_(t.price?.toFixed(2)),1),s("button",{class:"add-cart-btn",onClick:A(e=>L(t),["stop"])},"åŠ å…¥è´­ç‰©è½¦",8,qe),p.value[t.id]?(l(),c("div",De," âœ… å•†å“å·²æˆåŠŸæ·»åŠ åˆ°è´­ç‰©è½¦ï¼ ")):E("",!0)])],8,je))),128))])]),s("div",Fe,[r[2]||(r[2]=s("h2",{class:"section-title"},"çƒ­é—¨å•†å“",-1)),s("div",He,[(l(!0),c(y,null,w(G.value,t=>(l(),c("div",{class:"product-item",key:t.id,onClick:e=>S(t)},[s("div",Ue,[s("img",{src:I(t.picture,t.id),alt:t.name,onLoad:()=>B(t.id),onError:e=>x(e,t.id),class:H({loaded:v.value[t.id]})},null,42,Re),v.value[t.id]?E("",!0):(l(),c("div",Ve))]),s("div",ze,[s("h3",null,_(t.name),1),s("p",Ae,_(t.desc||t.description),1),s("p",Oe,"Â¥"+_(t.price?.toFixed(2)),1),s("button",{class:"add-cart-btn",onClick:A(e=>L(t),["stop"])},"åŠ å…¥è´­ç‰©è½¦",8,Je)])],8,Ne))),128))])])],64))])]))}},Qe=R(Ke,[["__scopeId","data-v-0e32ad68"]]),Xe={class:"home-banner"},Ye=["src","alt"],Ze=J({__name:"HomeBanner",setup(M){const k=f([{picture:"./images/Banner-1.jpg",alt:"æµ‹è¯•å›¾ç‰‡1"},{picture:"./images/Banner-2.jpg",alt:"æµ‹è¯•å›¾ç‰‡2"},{picture:"https://syf-5.github.io/public/images/Banner-3.webp",alt:"æµ‹è¯•å›¾ç‰‡3"},{picture:"https://syf-5.github.io/dist/images/Banner-4.webp",alt:"æµ‹è¯•å›¾ç‰‡4"}]);return U(()=>{console.log("è½®æ’­å›¾æ•°æ®å·²åŠ è½½:",k.value)}),(u,C)=>(l(),c("div",Xe,[j(O(Z),{height:"500px",interval:4e3,"indicator-position":"outside"},{default:N(()=>[(l(!0),c(y,null,w(k.value,(h,m)=>(l(),ee(O(se),{key:m},{default:N(()=>[s("img",{src:h.picture,alt:h.alt||"Banner"},null,8,Ye)]),_:2},1024))),128))]),_:1})]))}}),es=R(Ze,[["__scopeId","data-v-0f9ba2ac"]]),ss={class:"container"},ls={__name:"index",setup(M){return(k,u)=>(l(),c(y,null,[s("div",ss,[j(ye),j(es)]),j(Qe)],64))}};export{ls as default};
