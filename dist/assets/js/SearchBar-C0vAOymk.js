import{G as R,r as i,c as d,d as V,f as g,g as n,l as B,C as q,H as A,I as D,F as L,q as T,v as F,h as J,t as $,x as E,k as y,_ as G}from"./index-q-u-xzt-.js";import{p as M}from"./productService-BHw07omx.js";const U=R("search",()=>{const t=i([]),m=i(["手机","电脑","耳机","键盘","衣服","鞋子","包包","化妆品","食品","饮料","零食","平板"]),c=i([]),s=i([]),u=i(""),r=i(!1),h=()=>{const e=localStorage.getItem("searchHistory");if(e)try{t.value=JSON.parse(e)}catch(o){console.error("解析搜索历史失败:",o),t.value=[]}},f=e=>{if(!e.trim())return;const o=t.value.indexOf(e);o!==-1&&t.value.splice(o,1),t.value.unshift(e),t.value.length>10&&(t.value=t.value.slice(0,10)),localStorage.setItem("searchHistory",JSON.stringify(t.value))},S=e=>{t.value.splice(e,1),localStorage.setItem("searchHistory",JSON.stringify(t.value))},H=()=>{t.value=[],localStorage.removeItem("searchHistory")},k=e=>{const o=["水果","蔬菜","谷物","蛋类","服饰","手机","电脑","平板","耳机","衣服","鞋子","包包","美妆","食品","饮料","零食"];c.value=o.filter(_=>_.includes(e)).slice(0,5)},C=async e=>{await M.loadAllData();const o=M.getAllProducts();if(!e.trim())return o;const _=e.toLowerCase(),O={水果:"fruits",蔬菜:"vegetables",谷物:"grains",蛋类:"eggs",服饰:"clothing"}[e]?.toLowerCase()||"";return o.filter(N=>{const P=N.name.toLowerCase(),b=(N.category||N.categoryName||"")?.toLowerCase()||"";return P.includes(_)||b.includes(_)||b===O})},w=async e=>{r.value=!0,u.value=e;try{k(e);const o=await C(e);s.value=o,e.trim()&&f(e)}catch(o){console.error("搜索失败:",o),s.value=[]}finally{r.value=!1}},x=d(()=>t.value),I=d(()=>m.value),v=d(()=>c.value),l=d(()=>s.value),a=d(()=>u.value),p=d(()=>r.value);return{history:t,hotKeywords:m,suggestions:c,results:s,keyword:u,isLoading:r,getHistory:x,getHotKeywords:I,getSuggestions:v,getResults:l,getKeyword:a,getIsLoading:p,loadHistory:h,addToHistory:f,removeHistory:S,clearHistory:H,searchProducts:w}}),j={class:"search-container"},z={class:"search-box"},Q={key:0,class:"search-history"},W={class:"history-tags"},X=["onClick"],Y=["onClick"],Z={key:1,class:"search-suggestions"},K=["onClick"],ee=V({__name:"SearchBar",setup(t){const m=F(),c=U(),s=i(""),u=i(!1),r=i(!1),h=()=>{s.value.trim()&&(c.addToHistory(s.value),m.push({path:"/search",query:{q:s.value}}))},f=d(()=>c.history),S=d(()=>c.suggestions),H=v=>{s.value=v,h()},k=v=>{c.removeHistory(v)},C=()=>{c.clearHistory()},w=()=>{s.value="",u.value=!1},x=()=>{setTimeout(()=>{u.value=!1,r.value=!1},200)},I=v=>{s.value=v,r.value=!1,h()};return(v,l)=>(y(),g("div",j,[n("div",z,[q(n("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>s.value=a),type:"text",placeholder:"搜索商品...",onFocus:l[1]||(l[1]=a=>{u.value=!0,r.value=!0}),onInput:l[2]||(l[2]=a=>r.value=!0),onBlur:x,onKeyup:D(h,["enter"])},null,544),[[A,s.value]]),n("button",{onClick:h,class:"search-btn"},"搜索"),n("button",{onClick:w,class:"clear-btn"},"清空")]),u.value&&f.value.length?(y(),g("div",Q,[n("div",{class:"history-header"},[l[3]||(l[3]=n("span",null,"搜索历史",-1)),n("button",{onClick:C},"清空所有")]),n("div",W,[(y(!0),g(L,null,T(f.value,(a,p)=>(y(),g("span",{key:p,class:"history-tag",onClick:e=>H(a)},[J($(a)+" ",1),n("span",{class:"delete",onClick:E(e=>k(p),["stop"])},"×",8,Y)],8,X))),128))])])):B("",!0),r.value&&S.value.length?(y(),g("div",Z,[(y(!0),g(L,null,T(S.value,a=>(y(),g("div",{key:a},[n("span",{onClick:p=>I(a)},$(a),9,K)]))),128))])):B("",!0)]))}}),ae=G(ee,[["__scopeId","data-v-1ec116e3"]]);export{ae as S,U as u};
