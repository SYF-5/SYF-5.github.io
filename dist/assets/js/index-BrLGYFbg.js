import{d as E,B as W,r as u,c as C,o as M,C as Q,f as o,h as s,i as n,m as V,t as i,z as A,y as R,F as U,j,q as G,k as H,g as l,_ as J}from"./index-BHaF4bqM.js";import{u as K}from"./cart-DNnsDUIy.js";import{p as w}from"./productService-DLGyYyOD.js";const O={class:"product-detail-page"},X={class:"detail-header"},Y={class:"header-actions"},Z={key:0,class:"cart-count"},P={key:0,class:"loading"},tt={key:1,class:"error"},st={key:2,class:"detail-content"},et={class:"product-gallery"},at=["alt"],ot={key:0,class:"loading-placeholder"},lt={class:"product-info"},nt={class:"product-title"},it={class:"product-desc"},rt={class:"price-quantity-section"},ut={class:"price-rating"},dt={class:"current-price"},ct={key:0,class:"product-rating"},vt={class:"rating-value"},pt={class:"quantity-control-wrapper"},_t={class:"quantity-control"},mt=["disabled"],gt={class:"quantity"},yt=["disabled"],ft={key:0,class:"quantity-hint"},bt={key:0,class:"stock-info"},kt={key:1,class:"success-message"},ht={class:"detail-tabs"},Ct=["onClick"],wt={class:"tab-content"},xt={key:0},It={key:1},St={class:"spec-table"},qt={key:0},Tt={key:2},$t={key:3,class:"detail-footer"},Lt=["disabled"],Bt={key:0},Ft={key:1},Nt=["disabled"],zt=E({__name:"index",setup(Dt){const x=Q(),m=G(),g=K(),I=W(),a=u({}),r=u(1),v=u("detail"),d=u(!0),c=u(!1),p=u(!1),y=u(!1),f=u(!1),S=[{id:"detail",label:"å•†å“è¯¦æƒ…"},{id:"spec",label:"è§„æ ¼å‚æ•°"},{id:"review",label:"ç”¨æˆ·è¯„ä»·"}],k=C(()=>g.totalItems),b=C(()=>a.value.stock||30),q=()=>{r.value<b.value&&(r.value+=1)},T=()=>{r.value>1&&(r.value-=1)},h=async()=>{if(a.value){p.value=!0;try{await g.addToCart(a.value,r.value),y.value=!0,setTimeout(()=>{y.value=!1},3e3)}catch(e){const t=e;t.message==="è¯·å…ˆç™»å½•"?confirm("è¯·å…ˆç™»å½•ï¼Œç‚¹å‡»ç¡®å®šè·³è½¬åˆ°ç™»å½•é¡µ")&&m.push("/login"):alert(t.message||"æ·»åŠ å•†å“å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{p.value=!1}}},$=()=>{if(!I.isLogin){confirm("è¯·å…ˆç™»å½•ï¼Œç‚¹å‡»ç¡®å®šè·³è½¬åˆ°ç™»å½•é¡µ")&&m.push("/login");return}h().then(()=>{m.push("/cart")})},L=()=>{m.push("/cart")},B=()=>{f.value=!0},F=e=>{console.warn("å›¾ç‰‡åŠ è½½å¤±è´¥:",e.target.src),e.target.src="./images/cx.svg"},N=e=>e?e.startsWith("http")||e.startsWith("//")?e:e.startsWith("/")?`.${e}`:e.includes("/")?e.startsWith("list-")?`./images/${e}`:`./${e}`:`./images/${e}`:"./images/cx.svg",z=async e=>{d.value=!0,c.value=!1,f.value=!1;try{await w.loadAllData();const t=w.getProductById(e);if(t)a.value={id:t.id,name:t.name||"æœªçŸ¥å•†å“",price:t.price||0,picture:t.picture||"",description:t.description||t.desc||"æš‚æ— æè¿°",stock:t.stock||30,maxPurchase:Math.min(t.stock||30,30)};else throw new Error("æœªæ‰¾åˆ°è¯¥å•†å“")}catch(t){console.error("åŠ è½½å•†å“å¤±è´¥:",t),c.value=!0}finally{d.value=!1}};return M(()=>{g.loadFromLocalStorage();const e=Number(x.params.id);e?z(e):(c.value=!0,d.value=!1)}),(e,t)=>{const D=R("lazy");return l(),o("div",O,[s("header",X,[s("button",{onClick:t[0]||(t[0]=_=>e.$router.back()),class:"back-btn"},"â† è¿”å›"),t[4]||(t[4]=s("h1",null,"å•†å“è¯¦æƒ…",-1)),s("div",Y,[t[2]||(t[2]=s("button",null,"åˆ†äº«",-1)),t[3]||(t[3]=s("button",null,"æ”¶è—",-1)),s("div",{class:"cart-indicator",onClick:L},[t[1]||(t[1]=V(" ğŸ›’ ",-1)),k.value>0?(l(),o("span",Z,i(k.value),1)):n("",!0)])])]),d.value?(l(),o("div",P,[...t[5]||(t[5]=[s("p",null,"æ­£åœ¨åŠ è½½å•†å“ä¿¡æ¯...",-1)])])):n("",!0),c.value?(l(),o("div",tt,[...t[6]||(t[6]=[s("p",null,"åŠ è½½å•†å“ä¿¡æ¯å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•",-1)])])):n("",!0),!d.value&&!c.value&&a.value.id?(l(),o("main",st,[s("div",et,[A(s("img",{alt:a.value.name,class:"main-image",onLoad:B,onError:F,style:{width:"100%",height:"auto",opacity:"1",transition:"opacity 0.3s"}},null,40,at),[[D,N(a.value.picture)]]),f.value?n("",!0):(l(),o("div",ot,[...t[7]||(t[7]=[s("p",null,"å›¾ç‰‡åŠ è½½ä¸­...",-1)])]))]),s("div",lt,[s("h2",nt,i(a.value.name||"æœªçŸ¥å•†å“"),1),s("p",it,i(a.value.description||"æš‚æ— æè¿°"),1),s("div",rt,[s("div",ut,[s("span",dt,"Â¥"+i(a.value.price?.toFixed(2)),1),a.value.rating?(l(),o("div",ct,[t[8]||(t[8]=s("span",{class:"rating-stars"},"â˜…â˜…â˜…â˜…â˜…",-1)),s("span",vt,i(a.value.rating),1)])):n("",!0)]),s("div",pt,[s("div",_t,[s("button",{onClick:T,disabled:r.value<=1},"-",8,mt),s("span",gt,i(r.value),1),s("button",{onClick:q,disabled:r.value>=b.value},"+",8,yt)]),r.value>=b.value?(l(),o("div",ft," å·²è¾¾æœ€å¤§è´­ä¹°æ•°é‡ ")):n("",!0)])]),a.value.stock!==void 0?(l(),o("div",bt," åº“å­˜: "+i(a.value.stock)+"ä»¶ ",1)):n("",!0),y.value?(l(),o("div",kt," âœ… å•†å“å·²æˆåŠŸæ·»åŠ åˆ°è´­ç‰©è½¦ï¼ ")):n("",!0)]),s("div",ht,[(l(),o(U,null,j(S,_=>s("button",{key:_.id,class:H(["tab-btn",{active:v.value===_.id}]),onClick:Et=>v.value=_.id},i(_.label),11,Ct)),64))]),s("div",wt,[v.value==="detail"?(l(),o("div",xt,[t[9]||(t[9]=s("h3",null,"å•†å“è¯¦æƒ…",-1)),s("p",null,i(a.value.description||a.value.desc),1)])):n("",!0),v.value==="spec"?(l(),o("div",It,[t[14]||(t[14]=s("h3",null,"è§„æ ¼å‚æ•°",-1)),s("table",St,[s("tr",null,[t[10]||(t[10]=s("td",{class:"spec-label"},"å•†å“åç§°",-1)),s("td",null,i(a.value.name),1)]),s("tr",null,[t[11]||(t[11]=s("td",{class:"spec-label"},"ä»·æ ¼",-1)),s("td",null,"Â¥"+i(a.value.price?.toFixed(2)),1)]),s("tr",null,[t[12]||(t[12]=s("td",{class:"spec-label"},"åº“å­˜",-1)),s("td",null,i(a.value.stock||10)+"ä»¶",1)]),a.value.rating?(l(),o("tr",qt,[t[13]||(t[13]=s("td",{class:"spec-label"},"è¯„åˆ†",-1)),s("td",null,i(a.value.rating)+"åˆ†",1)])):n("",!0)])])):n("",!0),v.value==="review"?(l(),o("div",Tt,[...t[15]||(t[15]=[s("h3",null,"ç”¨æˆ·è¯„ä»·",-1),s("div",{class:"no-reviews"},[s("p",null,"æš‚æ— ç”¨æˆ·è¯„ä»·")],-1)])])):n("",!0)])])):n("",!0),!d.value&&!c.value&&a.value.id?(l(),o("footer",$t,[s("button",{class:"cart-btn",onClick:h,disabled:p.value},[p.value?(l(),o("span",Ft,"æ·»åŠ ä¸­...")):(l(),o("span",Bt,"åŠ å…¥è´­ç‰©è½¦"))],8,Lt),s("button",{class:"buy-btn",onClick:$,disabled:p.value},[...t[16]||(t[16]=[s("span",null,"ç«‹å³è´­ä¹°",-1)])],8,Nt)])):n("",!0)])}}}),Vt=J(zt,[["__scopeId","data-v-1751caab"]]);export{Vt as default};
