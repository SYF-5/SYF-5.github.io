import{d as D,r as d,c as C,o as E,B as W,f as o,h as s,i as n,m as M,t as i,z as Q,y as V,F as A,j as R,q as j,k as U,g as l,_ as G}from"./index-DgTuOyx3.js";import{u as H}from"./cart-vcQFai2N.js";import{p as w}from"./productService-DLGyYyOD.js";import"./user-CjfI2Pr5.js";const J={class:"product-detail-page"},K={class:"detail-header"},O={class:"header-actions"},X={key:0,class:"cart-count"},Y={key:0,class:"loading"},Z={key:1,class:"error"},P={key:2,class:"detail-content"},tt={class:"product-gallery"},st=["alt"],et={key:0,class:"loading-placeholder"},at={class:"product-info"},ot={class:"product-title"},lt={class:"product-desc"},nt={class:"price-quantity-section"},it={class:"price-rating"},rt={class:"current-price"},dt={key:0,class:"product-rating"},ut={class:"rating-value"},ct={class:"quantity-control-wrapper"},vt={class:"quantity-control"},pt=["disabled"],_t={class:"quantity"},mt=["disabled"],yt={key:0,class:"quantity-hint"},gt={key:0,class:"stock-info"},ft={key:1,class:"success-message"},kt={class:"detail-tabs"},bt=["onClick"],ht={class:"tab-content"},Ct={key:0},wt={key:1},xt={class:"spec-table"},It={key:0},qt={key:2},Tt={key:3,class:"detail-footer"},$t=["disabled"],St={key:0},Bt={key:1},Ft=["disabled"],Lt=D({__name:"index",setup(Nt){const x=W(),m=j(),y=H(),a=d({}),r=d(1),v=d("detail"),u=d(!0),c=d(!1),p=d(!1),g=d(!1),f=d(!1),I=[{id:"detail",label:"å•†å“è¯¦æƒ…"},{id:"spec",label:"è§„æ ¼å‚æ•°"},{id:"review",label:"ç”¨æˆ·è¯„ä»·"}],b=C(()=>y.totalItems),k=C(()=>a.value.stock||30),q=()=>{r.value<k.value&&(r.value+=1)},T=()=>{r.value>1&&(r.value-=1)},h=async()=>{if(a.value){p.value=!0;try{await y.addToCart(a.value,r.value),g.value=!0,setTimeout(()=>{g.value=!1},3e3)}catch(e){const t=e;t.message==="è¯·å…ˆç™»å½•"?confirm("è¯·å…ˆç™»å½•ï¼Œç‚¹å‡»ç¡®å®šè·³è½¬åˆ°ç™»å½•é¡µ")&&m.push("/login"):alert(t.message||"æ·»åŠ å•†å“å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{p.value=!1}}},$=()=>{h().then(()=>{m.push("/cart")})},S=()=>{m.push("/cart")},B=()=>{f.value=!0},F=e=>{console.warn("å›¾ç‰‡åŠ è½½å¤±è´¥:",e.target.src),e.target.src="./images/cx.svg"},L=e=>e?e.startsWith("http")||e.startsWith("//")?e:e.startsWith("/")?`.${e}`:e.includes("/")?e.startsWith("list-")?`./images/${e}`:`./${e}`:`./images/${e}`:"./images/cx.svg",N=async e=>{u.value=!0,c.value=!1,f.value=!1;try{await w.loadAllData();const t=w.getProductById(e);if(t)a.value={id:t.id,name:t.name||"æœªçŸ¥å•†å“",price:t.price||0,picture:t.picture||"",description:t.description||t.desc||"æš‚æ— æè¿°",stock:t.stock||30,maxPurchase:Math.min(t.stock||30,30)};else throw new Error("æœªæ‰¾åˆ°è¯¥å•†å“")}catch(t){console.error("åŠ è½½å•†å“å¤±è´¥:",t),c.value=!0}finally{u.value=!1}};return E(()=>{y.loadFromLocalStorage();const e=Number(x.params.id);e?N(e):(c.value=!0,u.value=!1)}),(e,t)=>{const z=V("lazy");return l(),o("div",J,[s("header",K,[s("button",{onClick:t[0]||(t[0]=_=>e.$router.back()),class:"back-btn"},"â† è¿”å›"),t[4]||(t[4]=s("h1",null,"å•†å“è¯¦æƒ…",-1)),s("div",O,[t[2]||(t[2]=s("button",null,"åˆ†äº«",-1)),t[3]||(t[3]=s("button",null,"æ”¶è—",-1)),s("div",{class:"cart-indicator",onClick:S},[t[1]||(t[1]=M(" ğŸ›’ ",-1)),b.value>0?(l(),o("span",X,i(b.value),1)):n("",!0)])])]),u.value?(l(),o("div",Y,[...t[5]||(t[5]=[s("p",null,"æ­£åœ¨åŠ è½½å•†å“ä¿¡æ¯...",-1)])])):n("",!0),c.value?(l(),o("div",Z,[...t[6]||(t[6]=[s("p",null,"åŠ è½½å•†å“ä¿¡æ¯å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•",-1)])])):n("",!0),!u.value&&!c.value&&a.value.id?(l(),o("main",P,[s("div",tt,[Q(s("img",{alt:a.value.name,class:"main-image",onLoad:B,onError:F,style:{width:"100%",height:"auto",opacity:"1",transition:"opacity 0.3s"}},null,40,st),[[z,L(a.value.picture)]]),f.value?n("",!0):(l(),o("div",et,[...t[7]||(t[7]=[s("p",null,"å›¾ç‰‡åŠ è½½ä¸­...",-1)])]))]),s("div",at,[s("h2",ot,i(a.value.name||"æœªçŸ¥å•†å“"),1),s("p",lt,i(a.value.description||"æš‚æ— æè¿°"),1),s("div",nt,[s("div",it,[s("span",rt,"Â¥"+i(a.value.price?.toFixed(2)),1),a.value.rating?(l(),o("div",dt,[t[8]||(t[8]=s("span",{class:"rating-stars"},"â˜…â˜…â˜…â˜…â˜…",-1)),s("span",ut,i(a.value.rating),1)])):n("",!0)]),s("div",ct,[s("div",vt,[s("button",{onClick:T,disabled:r.value<=1},"-",8,pt),s("span",_t,i(r.value),1),s("button",{onClick:q,disabled:r.value>=k.value},"+",8,mt)]),r.value>=k.value?(l(),o("div",yt," å·²è¾¾æœ€å¤§è´­ä¹°æ•°é‡ ")):n("",!0)])]),a.value.stock!==void 0?(l(),o("div",gt," åº“å­˜: "+i(a.value.stock)+"ä»¶ ",1)):n("",!0),g.value?(l(),o("div",ft," âœ… å•†å“å·²æˆåŠŸæ·»åŠ åˆ°è´­ç‰©è½¦ï¼ ")):n("",!0)]),s("div",kt,[(l(),o(A,null,R(I,_=>s("button",{key:_.id,class:U(["tab-btn",{active:v.value===_.id}]),onClick:zt=>v.value=_.id},i(_.label),11,bt)),64))]),s("div",ht,[v.value==="detail"?(l(),o("div",Ct,[t[9]||(t[9]=s("h3",null,"å•†å“è¯¦æƒ…",-1)),s("p",null,i(a.value.description||a.value.desc),1)])):n("",!0),v.value==="spec"?(l(),o("div",wt,[t[14]||(t[14]=s("h3",null,"è§„æ ¼å‚æ•°",-1)),s("table",xt,[s("tr",null,[t[10]||(t[10]=s("td",{class:"spec-label"},"å•†å“åç§°",-1)),s("td",null,i(a.value.name),1)]),s("tr",null,[t[11]||(t[11]=s("td",{class:"spec-label"},"ä»·æ ¼",-1)),s("td",null,"Â¥"+i(a.value.price?.toFixed(2)),1)]),s("tr",null,[t[12]||(t[12]=s("td",{class:"spec-label"},"åº“å­˜",-1)),s("td",null,i(a.value.stock||10)+"ä»¶",1)]),a.value.rating?(l(),o("tr",It,[t[13]||(t[13]=s("td",{class:"spec-label"},"è¯„åˆ†",-1)),s("td",null,i(a.value.rating)+"åˆ†",1)])):n("",!0)])])):n("",!0),v.value==="review"?(l(),o("div",qt,[...t[15]||(t[15]=[s("h3",null,"ç”¨æˆ·è¯„ä»·",-1),s("div",{class:"no-reviews"},[s("p",null,"æš‚æ— ç”¨æˆ·è¯„ä»·")],-1)])])):n("",!0)])])):n("",!0),!u.value&&!c.value&&a.value.id?(l(),o("footer",Tt,[s("button",{class:"cart-btn",onClick:h,disabled:p.value},[p.value?(l(),o("span",Bt,"æ·»åŠ ä¸­...")):(l(),o("span",St,"åŠ å…¥è´­ç‰©è½¦"))],8,$t),s("button",{class:"buy-btn",onClick:$,disabled:p.value},[...t[16]||(t[16]=[s("span",null,"ç«‹å³è´­ä¹°",-1)])],8,Ft)])):n("",!0)])}}}),Qt=G(Lt,[["__scopeId","data-v-1240f53d"]]);export{Qt as default};
