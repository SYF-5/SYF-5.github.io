import{G as R,r as u,c as d,d as V,f as y,g as n,l as B,C as q,H as A,I as D,F as b,q as L,v as F,h as J,t as T,x as M,k as g,_ as E}from"./index-DsC-O0Dj.js";import{p as $}from"./productService-BHw07omx.js";const G=R("search",()=>{const t=u([]),m=u(["手机","电脑","耳机","键盘","衣服","鞋子","包包","化妆品","食品","饮料","零食","平板"]),c=u([]),s=u([]),i=u(""),r=u(!1),h=()=>{const e=localStorage.getItem("searchHistory");if(e)try{t.value=JSON.parse(e)}catch(o){console.error("解析搜索历史失败:",o),t.value=[]}},f=e=>{if(!e.trim())return;const o=t.value.indexOf(e);o!==-1&&t.value.splice(o,1),t.value.unshift(e),t.value.length>10&&(t.value=t.value.slice(0,10)),localStorage.setItem("searchHistory",JSON.stringify(t.value))},S=e=>{t.value.splice(e,1),localStorage.setItem("searchHistory",JSON.stringify(t.value))},H=()=>{t.value=[],localStorage.removeItem("searchHistory")},k=e=>{const o=["水果","蔬菜","谷物","蛋类","服饰","手机","电脑","平板","耳机","衣服","鞋子","包包","美妆","食品","饮料","零食"];c.value=o.filter(_=>_.includes(e)).slice(0,5)},C=async e=>{await $.loadAllData();const o=$.getAllProducts();if(!e.trim())return o;const _=e.toLowerCase();return o.filter(I=>{const O=I.name.toLowerCase(),P=I.categoryName?.toLowerCase()||"";return O.includes(_)||P.includes(_)})},w=async e=>{r.value=!0,i.value=e;try{k(e);const o=await C(e);s.value=o,e.trim()&&f(e)}catch(o){console.error("搜索失败:",o),s.value=[]}finally{r.value=!1}},x=d(()=>t.value),N=d(()=>m.value),v=d(()=>c.value),l=d(()=>s.value),a=d(()=>i.value),p=d(()=>r.value);return{history:t,hotKeywords:m,suggestions:c,results:s,keyword:i,isLoading:r,getHistory:x,getHotKeywords:N,getSuggestions:v,getResults:l,getKeyword:a,getIsLoading:p,loadHistory:h,addToHistory:f,removeHistory:S,clearHistory:H,searchProducts:w}}),U={class:"search-container"},j={class:"search-box"},z={key:0,class:"search-history"},K={class:"history-tags"},Q=["onClick"],W=["onClick"],X={key:1,class:"search-suggestions"},Y=["onClick"],Z=V({__name:"SearchBar",setup(t){const m=F(),c=G(),s=u(""),i=u(!1),r=u(!1),h=()=>{s.value.trim()&&(c.addToHistory(s.value),m.push({path:"/search",query:{q:s.value}}))},f=d(()=>c.history),S=d(()=>c.suggestions),H=v=>{s.value=v,h()},k=v=>{c.removeHistory(v)},C=()=>{c.clearHistory()},w=()=>{s.value="",i.value=!1},x=()=>{setTimeout(()=>{i.value=!1,r.value=!1},200)},N=v=>{s.value=v,r.value=!1,h()};return(v,l)=>(g(),y("div",U,[n("div",j,[q(n("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>s.value=a),type:"text",placeholder:"搜索商品...",onFocus:l[1]||(l[1]=a=>{i.value=!0,r.value=!0}),onInput:l[2]||(l[2]=a=>r.value=!0),onBlur:x,onKeyup:D(h,["enter"])},null,544),[[A,s.value]]),n("button",{onClick:h,class:"search-btn"},"搜索"),n("button",{onClick:w,class:"clear-btn"},"清空")]),i.value&&f.value.length?(g(),y("div",z,[n("div",{class:"history-header"},[l[3]||(l[3]=n("span",null,"搜索历史",-1)),n("button",{onClick:C},"清空所有")]),n("div",K,[(g(!0),y(b,null,L(f.value,(a,p)=>(g(),y("span",{key:p,class:"history-tag",onClick:e=>H(a)},[J(T(a)+" ",1),n("span",{class:"delete",onClick:M(e=>k(p),["stop"])},"×",8,W)],8,Q))),128))])])):B("",!0),r.value&&S.value.length?(g(),y("div",X,[(g(!0),y(b,null,L(S.value,a=>(g(),y("div",{key:a},[n("span",{onClick:p=>N(a)},T(a),9,Y)]))),128))])):B("",!0)]))}}),se=E(Z,[["__scopeId","data-v-83e2a560"]]);export{se as S,G as u};
