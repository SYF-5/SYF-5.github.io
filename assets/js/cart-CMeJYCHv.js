import{G as q,r as f,c as u,B as I,A as $}from"./index-DUXVB-iX.js";const p=q("cart",()=>{const r=f([]),i=f(0),c=f(0),h=u(()=>r.value.reduce((t,e)=>t+e.quantity,0)),m=u(()=>r.value.reduce((t,e)=>t+e.price*e.quantity,0)),v=u(()=>m.value+i.value-c.value),g=u(()=>r.value.length===0);function w(){try{const t=localStorage.getItem("shopping_cart");if(t){const e=JSON.parse(t);r.value=e.cartItems||[],i.value=e.shipping||0,c.value=e.discount||0}}catch(t){console.error("加载购物车数据失败:",t),r.value=[]}}function s(){try{const t={cartItems:r.value,shipping:i.value,discount:c.value,lastUpdated:new Date().toISOString()};localStorage.setItem("shopping_cart",JSON.stringify(t))}catch(t){console.error("保存购物车数据失败:",t)}}function x(t,e=1){if(!I().isLogin)throw new Error("请先登录");const n=r.value.find(o=>o.id===t.id);if(n){const o=n.quantity+e;if(t.stock&&o>t.stock)throw new Error(`库存不足，当前库存为${t.stock}件`);if(t.maxPurchase&&o>t.maxPurchase)throw new Error(`该商品最多只能购买${t.maxPurchase}件`);n.quantity=o}else{if(t.stock&&e>t.stock)throw new Error(`库存不足，当前库存为${t.stock}件`);if(t.maxPurchase&&e>t.maxPurchase)throw new Error(`该商品最多只能购买${t.maxPurchase}件`);r.value.push({...t,quantity:e})}s(),$.success({message:"加入购物车成功",duration:2e3})}function y(t){const e=r.value.find(a=>a.id===t);if(e){if(e.stock&&e.quantity>=e.stock)throw new Error("库存不足，无法增加数量");if(e.maxPurchase&&e.quantity>=e.maxPurchase)throw new Error(`该商品最多只能购买${e.maxPurchase}件`);e.quantity++,s()}}function S(t){const e=r.value.find(a=>a.id===t);e&&(e.quantity>1?(e.quantity--,s()):l(t))}function d(t,e){const a=r.value.find(n=>n.id===t);if(a){if(e<1){l(t);return}if(a.stock&&e>a.stock)throw new Error(`库存不足，当前库存为${a.stock}件`);if(a.maxPurchase&&e>a.maxPurchase)throw new Error(`该商品最多只能购买${a.maxPurchase}件`);a.quantity=e,s()}}function l(t){r.value=r.value.filter(e=>e.id!==t),s()}function P(){r.value=[],s()}function k(t){return r.value.some(e=>e.id===t)}function E(t){const e=r.value.find(a=>a.id===t);return e?e.quantity:0}return{cartItems:r,shipping:i,discount:c,totalItems:h,subtotal:m,total:v,isEmpty:g,loadFromLocalStorage:w,saveToLocalStorage:s,addToCart:x,increaseQuantity:y,decreaseQuantity:S,updateQuantity:d,removeFromCart:l,clearCart:P,isInCart:k,getItemQuantity:E}});export{p as u};
