import{_ as E,r as u,c as C,o as W,D as z,f as l,g as t,l as n,h as M,t as i,C as Q,B as V,F as A,q as R,s as U,v as j,k as o}from"./index--MCLFqgv.js";import{u as G}from"./cart-CAc0grTL.js";import{p as w}from"./productService-BHw07omx.js";const H={class:"product-detail-page"},J={class:"detail-header"},K={class:"header-actions"},O={key:0,class:"cart-count"},X={key:0,class:"loading"},Y={key:1,class:"error"},Z={key:2,class:"detail-content"},P={class:"product-gallery"},tt=["alt"],st={key:0,class:"loading-placeholder"},et={class:"product-info"},at={class:"product-title"},lt={class:"product-desc"},ot={class:"price-quantity-section"},nt={class:"price-rating"},it={class:"current-price"},rt={key:0,class:"product-rating"},ut={class:"rating-value"},dt={class:"quantity-control-wrapper"},ct={class:"quantity-control"},vt=["disabled"],_t={class:"quantity"},pt=["disabled"],mt={key:0,class:"quantity-hint"},yt={key:0,class:"stock-info"},gt={key:1,class:"success-message"},bt={class:"detail-tabs"},kt=["onClick"],ft={class:"tab-content"},ht={key:0},Ct={key:1},wt={class:"spec-table"},xt={key:0},It={key:2},qt={key:3,class:"detail-footer"},Tt=["disabled"],$t={key:0},St={key:1},Bt=["disabled"],Dt={__name:"index",setup(Ft){const x=z(),k=j(),m=G(),a=u({}),r=u(1),v=u("detail"),d=u(!0),c=u(!1),_=u(!1),y=u(!1),g=u(!1),I=[{id:"detail",label:"å•†å“è¯¦æƒ…"},{id:"spec",label:"è§„æ ¼å‚æ•°"},{id:"review",label:"ç”¨æˆ·è¯„ä»·"}],f=C(()=>m.totalItems),b=C(()=>a.value.stock||30),q=()=>{r.value<b.value&&(r.value+=1)},T=()=>{r.value>1&&(r.value-=1)},h=async()=>{if(a.value){_.value=!0;try{await m.addToCart(a.value,r.value),y.value=!0,setTimeout(()=>{y.value=!1},3e3)}catch(e){alert(e.message||"æ·»åŠ å•†å“å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{_.value=!1}}},$=()=>{h().then(()=>{k.push("/cart")})},S=()=>{k.push("/cart")},B=()=>{g.value=!0},D=e=>{console.warn("å›¾ç‰‡åŠ è½½å¤±è´¥:",e.target.src),e.target.src="./images/cx.svg"},F=e=>e?e.startsWith("http")||e.startsWith("//")?e:e.startsWith("/")?`.${e}`:e.includes("/")?e.startsWith("list-")?`./images/${e}`:`./${e}`:`./images/${e}`:"./images/cx.svg",L=async e=>{d.value=!0,c.value=!1,g.value=!1;try{await w.loadAllData();const s=w.getProductById(e);if(s)a.value={id:s.id,name:s.name||"æœªçŸ¥å•†å“",price:s.price||0,picture:s.picture||"",description:s.description||s.desc||"æš‚æ— æè¿°",stock:s.stock||30,maxPurchase:Math.min(s.stock||30,30)};else throw new Error("æœªæ‰¾åˆ°è¯¥å•†å“")}catch(s){console.error("åŠ è½½å•†å“å¤±è´¥:",s),c.value=!0}finally{d.value=!1}};return W(()=>{m.loadFromLocalStorage();const e=Number(x.params.id);e?L(e):(c.value=!0,d.value=!1)}),(e,s)=>{const N=V("lazy");return o(),l("div",H,[t("header",J,[t("button",{onClick:s[0]||(s[0]=p=>e.$router.back()),class:"back-btn"},"â† è¿”å›"),s[4]||(s[4]=t("h1",null,"å•†å“è¯¦æƒ…",-1)),t("div",K,[s[2]||(s[2]=t("button",null,"åˆ†äº«",-1)),s[3]||(s[3]=t("button",null,"æ”¶è—",-1)),t("div",{class:"cart-indicator",onClick:S},[s[1]||(s[1]=M(" ğŸ›’ ",-1)),f.value>0?(o(),l("span",O,i(f.value),1)):n("",!0)])])]),d.value?(o(),l("div",X,[...s[5]||(s[5]=[t("p",null,"æ­£åœ¨åŠ è½½å•†å“ä¿¡æ¯...",-1)])])):n("",!0),c.value?(o(),l("div",Y,[...s[6]||(s[6]=[t("p",null,"åŠ è½½å•†å“ä¿¡æ¯å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•",-1)])])):n("",!0),!d.value&&!c.value&&a.value.id?(o(),l("main",Z,[t("div",P,[Q(t("img",{alt:a.value.name,class:"main-image",onLoad:B,onError:D,style:{width:"100%",height:"auto",opacity:"1",transition:"opacity 0.3s"}},null,40,tt),[[N,F(a.value.picture)]]),g.value?n("",!0):(o(),l("div",st,[...s[7]||(s[7]=[t("p",null,"å›¾ç‰‡åŠ è½½ä¸­...",-1)])]))]),t("div",et,[t("h2",at,i(a.value.name||"æœªçŸ¥å•†å“"),1),t("p",lt,i(a.value.description||"æš‚æ— æè¿°"),1),t("div",ot,[t("div",nt,[t("span",it,"Â¥"+i(a.value.price?.toFixed(2)),1),a.value.rating?(o(),l("div",rt,[s[8]||(s[8]=t("span",{class:"rating-stars"},"â˜…â˜…â˜…â˜…â˜…",-1)),t("span",ut,i(a.value.rating),1)])):n("",!0)]),t("div",dt,[t("div",ct,[t("button",{onClick:T,disabled:r.value<=1},"-",8,vt),t("span",_t,i(r.value),1),t("button",{onClick:q,disabled:r.value>=b.value},"+",8,pt)]),r.value>=b.value?(o(),l("div",mt," å·²è¾¾æœ€å¤§è´­ä¹°æ•°é‡ ")):n("",!0)])]),a.value.stock!==void 0?(o(),l("div",yt," åº“å­˜: "+i(a.value.stock)+"ä»¶ ",1)):n("",!0),y.value?(o(),l("div",gt," âœ… å•†å“å·²æˆåŠŸæ·»åŠ åˆ°è´­ç‰©è½¦ï¼ ")):n("",!0)]),t("div",bt,[(o(),l(A,null,R(I,p=>t("button",{key:p.id,class:U(["tab-btn",{active:v.value===p.id}]),onClick:Lt=>v.value=p.id},i(p.label),11,kt)),64))]),t("div",ft,[v.value==="detail"?(o(),l("div",ht,[s[9]||(s[9]=t("h3",null,"å•†å“è¯¦æƒ…",-1)),t("p",null,i(a.value.description||a.value.desc),1)])):n("",!0),v.value==="spec"?(o(),l("div",Ct,[s[14]||(s[14]=t("h3",null,"è§„æ ¼å‚æ•°",-1)),t("table",wt,[t("tr",null,[s[10]||(s[10]=t("td",{class:"spec-label"},"å•†å“åç§°",-1)),t("td",null,i(a.value.name),1)]),t("tr",null,[s[11]||(s[11]=t("td",{class:"spec-label"},"ä»·æ ¼",-1)),t("td",null,"Â¥"+i(a.value.price?.toFixed(2)),1)]),t("tr",null,[s[12]||(s[12]=t("td",{class:"spec-label"},"åº“å­˜",-1)),t("td",null,i(a.value.stock||10)+"ä»¶",1)]),a.value.rating?(o(),l("tr",xt,[s[13]||(s[13]=t("td",{class:"spec-label"},"è¯„åˆ†",-1)),t("td",null,i(a.value.rating)+"åˆ†",1)])):n("",!0)])])):n("",!0),v.value==="review"?(o(),l("div",It,[...s[15]||(s[15]=[t("h3",null,"ç”¨æˆ·è¯„ä»·",-1),t("div",{class:"no-reviews"},[t("p",null,"æš‚æ— ç”¨æˆ·è¯„ä»·")],-1)])])):n("",!0)])])):n("",!0),!d.value&&!c.value&&a.value.id?(o(),l("footer",qt,[t("button",{class:"cart-btn",onClick:h,disabled:_.value},[_.value?(o(),l("span",St,"æ·»åŠ ä¸­...")):(o(),l("span",$t,"åŠ å…¥è´­ç‰©è½¦"))],8,Tt),t("button",{class:"buy-btn",onClick:$,disabled:_.value},[...s[16]||(s[16]=[t("span",null,"ç«‹å³è´­ä¹°",-1)])],8,Bt)])):n("",!0)])}}},zt=E(Dt,[["__scopeId","data-v-d3afe8eb"]]);export{zt as default};
