import{G as V,r as v,c as d,d as $,f as y,g as r,l as B,C as q,H as A,I as D,F as I,q as b,v as F,h as J,t as L,x as M,k as g,_ as E}from"./index-CDabiwuU.js";import{p as T}from"./productService-BHw07omx.js";const G=V("search",()=>{const t=v([]),f=v(["手机","电脑","耳机","键盘","衣服","鞋子","包包","化妆品","食品","饮料","零食","平板"]),l=v([]),o=v([]),n=v(""),c=v(!1),m=()=>{const e=localStorage.getItem("searchHistory");if(e)try{t.value=JSON.parse(e)}catch(s){console.error("解析搜索历史失败:",s),t.value=[]}},h=e=>{if(!e.trim())return;const s=t.value.indexOf(e);s!==-1&&t.value.splice(s,1),t.value.unshift(e),t.value.length>10&&(t.value=t.value.slice(0,10)),localStorage.setItem("searchHistory",JSON.stringify(t.value))},_=e=>{t.value.splice(e,1),localStorage.setItem("searchHistory",JSON.stringify(t.value))},H=()=>{t.value=[],localStorage.removeItem("searchHistory")},k=e=>{const s=["水果","蔬菜","谷物","蛋类","服饰","手机","电脑","平板","耳机","衣服","鞋子","包包","美妆","食品","饮料","零食"];l.value=s.filter(S=>S.includes(e)).slice(0,5)},C=async e=>{await T.loadAllData();const s=T.getAllProducts();if(!e.trim())return s;const S=e.toLowerCase();return s.filter(x=>{const P=x.name.toLowerCase(),R=x.categoryName?.toLowerCase()||"";return P.includes(S)||R.includes(S)})},w=async e=>{c.value=!0,n.value=e;try{k(e);const s=await C(e);o.value=s,e.trim()&&h(e)}catch(s){console.error("搜索失败:",s),o.value=[]}finally{c.value=!1}},i=d(()=>t.value),u=d(()=>f.value),a=d(()=>l.value),p=d(()=>o.value),N=d(()=>n.value),O=d(()=>c.value);return{history:t,hotKeywords:f,suggestions:l,results:o,keyword:n,isLoading:c,getHistory:i,getHotKeywords:u,getSuggestions:a,getResults:p,getKeyword:N,getIsLoading:O,loadHistory:m,addToHistory:h,removeHistory:_,clearHistory:H,searchProducts:w}}),U={class:"search-container"},j={class:"search-box"},z={key:0,class:"search-history"},K={class:"history-tags"},Q=["onClick"],W=["onClick"],X={key:1,class:"search-suggestions"},Y=["onClick"],Z=$({__name:"SearchBar",setup(t){const f=F(),l=G(),o=v(""),n=v(!1),c=()=>{o.value.trim()&&(l.addToHistory(o.value),f.push({path:"/search",query:{q:o.value}}))},m=d(()=>l.history),h=d(()=>l.suggestions),_=i=>{o.value=i,c()},H=i=>{l.removeHistory(i)},k=()=>{l.clearHistory()},C=()=>{o.value="",n.value=!1},w=()=>{setTimeout(()=>{n.value=!1},200)};return(i,u)=>(g(),y("div",U,[r("div",j,[q(r("input",{"onUpdate:modelValue":u[0]||(u[0]=a=>o.value=a),type:"text",placeholder:"搜索商品...",onFocus:u[1]||(u[1]=a=>n.value=!0),onBlur:w,onKeyup:D(c,["enter"])},null,544),[[A,o.value]]),r("button",{onClick:c,class:"search-btn"},"搜索"),r("button",{onClick:C,class:"clear-btn"},"清空")]),n.value&&m.value.length?(g(),y("div",z,[r("div",{class:"history-header"},[u[2]||(u[2]=r("span",null,"搜索历史",-1)),r("button",{onClick:k},"清空所有")]),r("div",K,[(g(!0),y(I,null,b(m.value,(a,p)=>(g(),y("span",{key:p,class:"history-tag",onClick:N=>_(a)},[J(L(a)+" ",1),r("span",{class:"delete",onClick:M(N=>H(p),["stop"])},"×",8,W)],8,Q))),128))])])):B("",!0),i.showSuggestions&&h.value.length?(g(),y("div",X,[(g(!0),y(I,null,b(h.value,a=>(g(),y("div",{key:a},[r("span",{onClick:p=>i.selectSuggestion(a)},L(a),9,Y)]))),128))])):B("",!0)]))}}),se=E(Z,[["__scopeId","data-v-7ce15f0e"]]);export{se as S,G as u};
